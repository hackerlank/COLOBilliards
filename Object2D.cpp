///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Object2D.cpp
//	ryuji oka
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "main.h"
#include "Object2D.h"
#include "Scene.h"
#include "Manager.h"
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// マクロ定義
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// プロトタイプ宣言
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// グローバル変数
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// コンストラクタ
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Object2D::Object2D(int nPriority):Scene(nPriority)
{
	m_pVtxBuff	= NULL;
	m_pTexture	= NULL;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// デストラクタ
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Object2D::~Object2D()
{
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Init関数
//	:
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
HRESULT Object2D::Init(D3DXVECTOR3 pos,D3DXVECTOR3 size,LPDIRECT3DTEXTURE9 pTexture)
{	
	m_pos=pos;
	m_scl=size;
	LPDIRECT3DDEVICE9 pDevice=Manager::GetRenderer()->GetDevice();
	pDevice->CreateVertexBuffer(sizeof(VERTEX_2D)*4,
									D3DUSAGE_WRITEONLY,
									FVF_VERTEX_2D,
									D3DPOOL_MANAGED,
									&m_pVtxBuff,
									NULL);
	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(pos.x,pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(pos.x+size.x,pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(pos.x,pos.y+size.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(pos.x+size.x,pos.y+size.y,0.0f);
		
	m_aVertex[0].rhw = 1.0f;
	m_aVertex[1].rhw = 1.0f;
	m_aVertex[2].rhw = 1.0f;
	m_aVertex[3].rhw = 1.0f;
	
	//色情報
	m_aVertex[0].col = D3DCOLOR_RGBA(255,255,255,255);
	m_aVertex[1].col = D3DCOLOR_RGBA(255,255,255,255);
	m_aVertex[2].col = D3DCOLOR_RGBA(255,255,255,255);
	m_aVertex[3].col = D3DCOLOR_RGBA(255,255,255,255);

	m_aVertex[0].tex = D3DXVECTOR2(0.0f/* 座標U */,0.0f /* 座標V */ );
	m_aVertex[1].tex = D3DXVECTOR2(1.0f/* 座標U */,0.0f /* 座標V */ );
	m_aVertex[2].tex = D3DXVECTOR2(0.0f/* 座標U */,1.0f /* 座標V */ );
	m_aVertex[3].tex = D3DXVECTOR2(1.0f/* 座標U */,1.0f /* 座標V */ );
		
	m_pVtxBuff->Unlock();

	//テクスチャ読み込み
	m_pTexture=pTexture;
	
	OBJ_TYPE=NULL;
	return S_OK;
}

HRESULT Object2D::Init(D3DXVECTOR3 pos,D3DXVECTOR3 size,int alpha,LPDIRECT3DTEXTURE9 pTexture)
{	
	m_pos=pos;
	m_scl=size;
	LPDIRECT3DDEVICE9 pDevice=Manager::GetRenderer()->GetDevice();
	pDevice->CreateVertexBuffer(sizeof(VERTEX_2D)*4,
									D3DUSAGE_WRITEONLY,
									FVF_VERTEX_2D,
									D3DPOOL_MANAGED,
									&m_pVtxBuff,
									NULL);
	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(pos.x,pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(pos.x+size.x,pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(pos.x,pos.y+size.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(pos.x+size.x,pos.y+size.y,0.0f);
		
	m_aVertex[0].rhw = 1.0f;
	m_aVertex[1].rhw = 1.0f;
	m_aVertex[2].rhw = 1.0f;
	m_aVertex[3].rhw = 1.0f;
	
	//色情報
	m_aVertex[0].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[1].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[2].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[3].col = D3DCOLOR_RGBA(255,255,255,alpha);

	m_aVertex[0].tex = D3DXVECTOR2(0.0f/* 座標U */,0.0f /* 座標V */ );
	m_aVertex[1].tex = D3DXVECTOR2(1.0f/* 座標U */,0.0f /* 座標V */ );
	m_aVertex[2].tex = D3DXVECTOR2(0.0f/* 座標U */,1.0f /* 座標V */ );
	m_aVertex[3].tex = D3DXVECTOR2(1.0f/* 座標U */,1.0f /* 座標V */ );
		
	m_pVtxBuff->Unlock();

	//テクスチャ読み込み
	m_pTexture=pTexture;
	
	OBJ_TYPE=NULL;
	return S_OK;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Uninit関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::Uninit(void)
{	
	if (m_pTexture != NULL)
	{
		m_pTexture = NULL;
	}

	if(m_pVtxBuff != NULL)
	{
		m_pVtxBuff->Release();
		m_pVtxBuff = NULL;
	}

	Release();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Update関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::Update(void)
{
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Draw関数
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::Draw(void)
{
	LPDIRECT3DDEVICE9 pDevice=Manager::GetRenderer()->GetDevice();
	
	//頂点バッファをデータストリームにバインド
	pDevice->SetStreamSource(0,m_pVtxBuff,0,sizeof(VERTEX_2D));

	//頂点フォーマットの設定
	pDevice->SetFVF(FVF_VERTEX_2D);

	//テクスチャの設定
	pDevice->SetTexture(0,m_pTexture);

	//ポリゴンの描画
	pDevice->DrawPrimitive(D3DPT_TRIANGLESTRIP,//プリンミティブの種類
									0,//描画するプリミティブ数
									2);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	初期位置に戻す関数
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::TimeLeap(void)
{
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetPosition関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetPosition(float x,float y,float z)
{
	m_pos.x=x;
	m_pos.y=y;
	m_pos.z=z;
	
	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(m_pos.x,m_pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(m_pos.x,m_pos.y+m_scl.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y+m_scl.y,0.0f);
		
	m_pVtxBuff->Unlock();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetPosition関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetPosition(D3DXVECTOR3 pos)
{
	m_pos=pos;

	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(m_pos.x,m_pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(m_pos.x,m_pos.y+m_scl.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y+m_scl.y,0.0f);
		
	m_pVtxBuff->Unlock();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetRotation関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetRotation(float x,float y,float z)
{
	m_rot.x=x;
	m_rot.y=y;
	m_rot.z=z;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetRotation関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetRotation(D3DXVECTOR3 rot)
{
	m_rot=rot;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetRotation関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetScale(float x,float y,float z)
{
	m_scl.x=x;
	m_scl.y=y;
	m_scl.z=z;

	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(m_pos.x,m_pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(m_pos.x,m_pos.y+m_scl.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y+m_scl.y,0.0f);
		
	m_pVtxBuff->Unlock();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetRotation関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetScale(D3DXVECTOR3 scl)
{
	m_scl=scl;
	
	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	//座標
	m_aVertex[0].pos = D3DXVECTOR3(m_pos.x,m_pos.y,0.0f);
	m_aVertex[1].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y,0.0f);
	m_aVertex[2].pos = D3DXVECTOR3(m_pos.x,m_pos.y+m_scl.y,0.0f);
	m_aVertex[3].pos = D3DXVECTOR3(m_pos.x+m_scl.x,m_pos.y+m_scl.y,0.0f);
		
	m_pVtxBuff->Unlock();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetAnimation関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetAnimation(int num)
{
	//頂点情報の設定
	VERTEX_2D *pVtx;

	m_pVtxBuff->Lock(0,0,(void**)&pVtx,0);
	
	pVtx[0].tex = D3DXVECTOR2( (((float)num-1.0f)/10) /* 座標U */, 0.0f /* 座標V */ );
	pVtx[1].tex = D3DXVECTOR2( ((float)num/10)		/* 座標U */, 0.0f /* 座標V */ );
	pVtx[2].tex = D3DXVECTOR2( (((float)num-1.0f)/10) /* 座標U */, 1.0f /* 座標V */ );
	pVtx[3].tex = D3DXVECTOR2( ((float)num/10)		/* 座標U */, 1.0f /* 座標V */ );

	m_pVtxBuff->Unlock();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Create関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Object2D* Object2D::Create(D3DXVECTOR3 pos,D3DXVECTOR3 size,LPDIRECT3DTEXTURE9 pTexture,int nPriority)
{
	Object2D *pRet = new Object2D(nPriority);
	pRet->Init(pos,size,pTexture);
	return pRet;
}

Object2D* Object2D::Create(D3DXVECTOR3 pos,D3DXVECTOR3 size,int alpha,LPDIRECT3DTEXTURE9 pTexture,int nPriority)
{
	Object2D *pRet = new Object2D(nPriority);
	pRet->Init(pos,size,alpha,pTexture);
	return pRet;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetAlpha関数
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Object2D::SetAlpha(int alpha)
{
	m_pVtxBuff->Lock(0,0,(void**)&m_aVertex,0);
	
	m_aVertex[0].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[1].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[2].col = D3DCOLOR_RGBA(255,255,255,alpha);
	m_aVertex[3].col = D3DCOLOR_RGBA(255,255,255,alpha);

	m_pVtxBuff->Unlock();
}